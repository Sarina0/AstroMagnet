{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\nimport { useEffect, useState, useContext } from \"react\";\nimport firestore from \"@react-native-firebase/firestore\";\nimport { UserContext } from \"../context/user\";\nexport default function useLooking(onError) {\n  var _useState = useState([]),\n    _useState2 = _slicedToArray(_useState, 2),\n    users = _useState2[0],\n    setUsers = _useState2[1];\n  var _useState3 = useState(true),\n    _useState4 = _slicedToArray(_useState3, 2),\n    loading = _useState4[0],\n    setLoading = _useState4[1];\n  var _useContext = useContext(UserContext),\n    profile = _useContext.profile;\n  useEffect(function () {\n    if (!profile) return;\n    var unsubscribe = firestore().collection(\"users\").where(firestore.FieldPath.documentId(), \"!=\", profile.id).onSnapshot(function (querySnapshot) {\n      var list = [];\n      querySnapshot.forEach(function (doc) {\n        if (!(profile != null && profile.liked.includes(doc.id)) && !(profile != null && profile.disliked.includes(doc.id)) && !(profile != null && profile.messagingFriendList.map(function (friend) {\n          return friend.email;\n        }).includes(doc.data().email)) && profile.interestedType.includes(doc.data().sex) && doc.data().interestedType.includes(profile.sex) && !doc.data().disliked.includes(profile.id)) {\n          list.push(_objectSpread({\n            id: doc.id\n          }, doc.data()));\n        }\n        list.sort(function (a, b) {\n          if (b) {\n            return (a == null ? void 0 : a.createdAt.toDate()) - b.createdAt.toDate();\n          }\n          return 0;\n        });\n      });\n      setUsers(list);\n      setLoading(false);\n    }, function (error) {\n      onError && onError(\"Error fetching users\");\n      console.log(\"[LOG] error fetching users:\", error);\n    });\n    return unsubscribe;\n  }, [profile == null ? void 0 : profile.id, profile == null ? void 0 : profile.liked, profile == null ? void 0 : profile.disliked, profile == null ? void 0 : profile.interestedType, profile == null ? void 0 : profile.messagingFriendList]);\n  return {\n    users: users,\n    loading: loading\n  };\n}","map":{"version":3,"names":["useEffect","useState","useContext","firestore","UserContext","useLooking","onError","users","setUsers","loading","setLoading","profile","unsubscribe","collection","where","FieldPath","documentId","id","onSnapshot","querySnapshot","list","forEach","doc","liked","includes","disliked","messagingFriendList","map","friend","email","data","interestedType","sex","push","sort","a","b","createdAt","toDate","error","console","log"],"sources":["/Users/sonminhnguyen/Documents/programming/react-native/school/astro_magnet_initial/astro_magnet/src/hooks/useLooking.tsx"],"sourcesContent":["import {useEffect, useState, useContext} from \"react\";\nimport firestore from \"@react-native-firebase/firestore\";\nimport { FireDoc } from \"@app/shared/interfaces/firebase\";\nimport { UserContext } from \"@app/context/user\";\n\n/**\n * use users hooks, fetch all user from firestore\n * users will not include current logged in user\n * users will not include users that current logged-in user already liked or disliked\n * @param {(error: string)=>void | undefined} onError - callback function to handle network error\n * @returns {users: FirebaseFirestoreTypes.DocumentData[], loading: boolean} - a list of users and loading state\n */\nexport default function useLooking(\n    onError?: (error: string) => void,\n) {\n    const [users, setUsers] = useState<FireDoc[]>([]);\n    const [loading, setLoading] = useState<boolean>(true);\n    const { profile } = useContext(UserContext);\n    useEffect(() => {\n        if (!profile) return;\n        const unsubscribe = firestore()\n            .collection(\"users\")\n            .where(firestore.FieldPath.documentId(), \"!=\", profile.id)\n            .onSnapshot((querySnapshot) => {\n                const list: FireDoc[] = [];\n                querySnapshot.forEach((doc) => {\n                    if (\n                        !profile?.liked.includes(doc.id) && \n                        !profile?.disliked.includes(doc.id) &&\n                        !profile?.messagingFriendList.map(\n                            (friend) => friend.email\n                        ).includes(doc.data().email) &&\n                        profile.interestedType.includes(doc.data().sex) &&\n                        doc.data().interestedType.includes(profile.sex) &&\n                        !doc.data().disliked.includes(profile.id)\n                        ) {\n                        list.push({\n                            id: doc.id,\n                            ...doc.data(),\n                        });\n                    }\n                    list.sort((a, b) => {\n                        if (b) {\n                            return a?.createdAt.toDate() - b.createdAt.toDate();\n                        }\n                        return 0;\n                    });\n                });\n                setUsers(list);\n                setLoading(false);\n            }, (error) => {\n                onError && onError(\"Error fetching users\");\n                console.log(\"[LOG] error fetching users:\", error);\n            });\n        return unsubscribe;\n    }, [\n        profile?.id,\n        profile?.liked,\n        profile?.disliked,\n        profile?.interestedType,\n        profile?.messagingFriendList,\n    ]);\n    return {\n\n        /** result after look */\n        users,\n\n        /** loading state of fetching result */\n        loading\n    }\n}"],"mappings":";;;;AAAA,SAAQA,SAAS,EAAEC,QAAQ,EAAEC,UAAU,QAAO,OAAO;AACrD,OAAOC,SAAS,MAAM,kCAAkC;AAExD,SAASC,WAAW;AASpB,eAAe,SAASC,UAAU,CAC9BC,OAAiC,EACnC;EACE,gBAA0BL,QAAQ,CAAY,EAAE,CAAC;IAAA;IAA1CM,KAAK;IAAEC,QAAQ;EACtB,iBAA8BP,QAAQ,CAAU,IAAI,CAAC;IAAA;IAA9CQ,OAAO;IAAEC,UAAU;EAC1B,kBAAoBR,UAAU,CAACE,WAAW,CAAC;IAAnCO,OAAO,eAAPA,OAAO;EACfX,SAAS,CAAC,YAAM;IACZ,IAAI,CAACW,OAAO,EAAE;IACd,IAAMC,WAAW,GAAGT,SAAS,EAAE,CAC1BU,UAAU,CAAC,OAAO,CAAC,CACnBC,KAAK,CAACX,SAAS,CAACY,SAAS,CAACC,UAAU,EAAE,EAAE,IAAI,EAAEL,OAAO,CAACM,EAAE,CAAC,CACzDC,UAAU,CAAC,UAACC,aAAa,EAAK;MAC3B,IAAMC,IAAe,GAAG,EAAE;MAC1BD,aAAa,CAACE,OAAO,CAAC,UAACC,GAAG,EAAK;QAC3B,IACI,EAACX,OAAO,YAAPA,OAAO,CAAEY,KAAK,CAACC,QAAQ,CAACF,GAAG,CAACL,EAAE,CAAC,KAChC,EAACN,OAAO,YAAPA,OAAO,CAAEc,QAAQ,CAACD,QAAQ,CAACF,GAAG,CAACL,EAAE,CAAC,KACnC,EAACN,OAAO,YAAPA,OAAO,CAAEe,mBAAmB,CAACC,GAAG,CAC7B,UAACC,MAAM;UAAA,OAAKA,MAAM,CAACC,KAAK;QAAA,EAC3B,CAACL,QAAQ,CAACF,GAAG,CAACQ,IAAI,EAAE,CAACD,KAAK,CAAC,KAC5BlB,OAAO,CAACoB,cAAc,CAACP,QAAQ,CAACF,GAAG,CAACQ,IAAI,EAAE,CAACE,GAAG,CAAC,IAC/CV,GAAG,CAACQ,IAAI,EAAE,CAACC,cAAc,CAACP,QAAQ,CAACb,OAAO,CAACqB,GAAG,CAAC,IAC/C,CAACV,GAAG,CAACQ,IAAI,EAAE,CAACL,QAAQ,CAACD,QAAQ,CAACb,OAAO,CAACM,EAAE,CAAC,EACvC;UACFG,IAAI,CAACa,IAAI;YACLhB,EAAE,EAAEK,GAAG,CAACL;UAAE,GACPK,GAAG,CAACQ,IAAI,EAAE,EACf;QACN;QACAV,IAAI,CAACc,IAAI,CAAC,UAACC,CAAC,EAAEC,CAAC,EAAK;UAChB,IAAIA,CAAC,EAAE;YACH,OAAO,CAAAD,CAAC,oBAADA,CAAC,CAAEE,SAAS,CAACC,MAAM,EAAE,IAAGF,CAAC,CAACC,SAAS,CAACC,MAAM,EAAE;UACvD;UACA,OAAO,CAAC;QACZ,CAAC,CAAC;MACN,CAAC,CAAC;MACF9B,QAAQ,CAACY,IAAI,CAAC;MACdV,UAAU,CAAC,KAAK,CAAC;IACrB,CAAC,EAAE,UAAC6B,KAAK,EAAK;MACVjC,OAAO,IAAIA,OAAO,CAAC,sBAAsB,CAAC;MAC1CkC,OAAO,CAACC,GAAG,CAAC,6BAA6B,EAAEF,KAAK,CAAC;IACrD,CAAC,CAAC;IACN,OAAO3B,WAAW;EACtB,CAAC,EAAE,CACCD,OAAO,oBAAPA,OAAO,CAAEM,EAAE,EACXN,OAAO,oBAAPA,OAAO,CAAEY,KAAK,EACdZ,OAAO,oBAAPA,OAAO,CAAEc,QAAQ,EACjBd,OAAO,oBAAPA,OAAO,CAAEoB,cAAc,EACvBpB,OAAO,oBAAPA,OAAO,CAAEe,mBAAmB,CAC/B,CAAC;EACF,OAAO;IAGHnB,KAAK,EAALA,KAAK;IAGLE,OAAO,EAAPA;EACJ,CAAC;AACL"},"metadata":{},"sourceType":"module"}