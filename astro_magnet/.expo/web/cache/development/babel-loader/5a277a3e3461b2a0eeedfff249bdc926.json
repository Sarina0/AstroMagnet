{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\nimport { useState, useEffect, useContext } from \"react\";\nimport firestore from \"@react-native-firebase/firestore\";\nimport { UserContext } from \"../context/user\";\nexport default function useChatChannels(onError) {\n  var _useContext = useContext(UserContext),\n    profile = _useContext.profile;\n  var _useState = useState([]),\n    _useState2 = _slicedToArray(_useState, 2),\n    channels = _useState2[0],\n    setChannels = _useState2[1];\n  var _useState3 = useState(true),\n    _useState4 = _slicedToArray(_useState3, 2),\n    loading = _useState4[0],\n    setLoading = _useState4[1];\n  useEffect(function () {\n    if (!profile) {\n      setLoading(false);\n      return;\n    }\n    if (profile.messagingFriendList.length === 0) {\n      setLoading(false);\n      setChannels([]);\n      return;\n    }\n    var chatRoomIds = profile.messagingFriendList.map(function (friend) {\n      return friend.chatRoomId;\n    });\n    var unsubscribe = firestore().collection(\"chatRooms\").where(firestore.FieldPath.documentId(), \"in\", chatRoomIds).onSnapshot(function (querySnapshot) {\n      var list = [];\n      querySnapshot.forEach(function (doc) {\n        list.push(_objectSpread({\n          id: doc.id\n        }, doc.data()));\n      });\n      setChannels(list);\n      setLoading(false);\n    }, function (error) {\n      setLoading(false);\n      onError && onError(\"Error fetching chatrooms\");\n      console.log(\"[ERROR] error fetching chatrooms:\", error);\n    });\n    return unsubscribe;\n  }, [profile == null ? void 0 : profile.messagingFriendList]);\n  return {\n    channels: channels,\n    loading: loading\n  };\n}","map":{"version":3,"names":["useState","useEffect","useContext","firestore","UserContext","useChatChannels","onError","profile","channels","setChannels","loading","setLoading","messagingFriendList","length","chatRoomIds","map","friend","chatRoomId","unsubscribe","collection","where","FieldPath","documentId","onSnapshot","querySnapshot","list","forEach","doc","push","id","data","error","console","log"],"sources":["/Users/sonminhnguyen/Documents/programming/react-native/school/astro_magnet_initial/astro_magnet/src/hooks/useChatChannels.tsx"],"sourcesContent":["import { useState, useEffect, useContext } from \"react\";\nimport firestore from \"@react-native-firebase/firestore\";\nimport { FireDoc } from \"@app/shared/interfaces/firebase\";\nimport type { ChatRoom } from \"@app/shared/interfaces/message\";\nimport {UserContext} from \"@app/context/user\";\n\nexport default function useChatChannels(\n    onError?: (error: string) => void\n) {\n    const { profile } = useContext(UserContext);\n    const [channels, setChannels] = useState<ChatRoom[]>([]);\n    const [loading, setLoading] = useState<boolean>(true);\n\n    useEffect(()=>{\n        if (!profile) {\n            setLoading(false);\n            return;\n        }\n        if (profile.messagingFriendList.length === 0) {\n            setLoading(false);\n            setChannels([]);\n            return;\n        }\n        const chatRoomIds = profile.messagingFriendList.map((friend) => friend.chatRoomId);\n        const unsubscribe = firestore()\n            .collection(\"chatRooms\")\n            .where(firestore.FieldPath.documentId(), \"in\", chatRoomIds)\n            .onSnapshot(\n                (querySnapshot) => {\n                    const list: FireDoc[] = [];\n                    querySnapshot.forEach((doc) => {\n                        list.push({\n                            id: doc.id,\n                            ...doc.data(),\n                        });\n                    });\n                    setChannels(list as ChatRoom[]);\n                    setLoading(false);\n                },\n                (error) => {\n                    setLoading(false);\n                    onError && onError(\"Error fetching chatrooms\");\n                    console.log(\"[ERROR] error fetching chatrooms:\", error);\n                });\n        return unsubscribe;\n    },[profile?.messagingFriendList])\n    return {\n        channels,\n        loading\n    }\n}"],"mappings":";;;;AAAA,SAASA,QAAQ,EAAEC,SAAS,EAAEC,UAAU,QAAQ,OAAO;AACvD,OAAOC,SAAS,MAAM,kCAAkC;AAGxD,SAAQC,WAAW;AAEnB,eAAe,SAASC,eAAe,CACnCC,OAAiC,EACnC;EACE,kBAAoBJ,UAAU,CAACE,WAAW,CAAC;IAAnCG,OAAO,eAAPA,OAAO;EACf,gBAAgCP,QAAQ,CAAa,EAAE,CAAC;IAAA;IAAjDQ,QAAQ;IAAEC,WAAW;EAC5B,iBAA8BT,QAAQ,CAAU,IAAI,CAAC;IAAA;IAA9CU,OAAO;IAAEC,UAAU;EAE1BV,SAAS,CAAC,YAAI;IACV,IAAI,CAACM,OAAO,EAAE;MACVI,UAAU,CAAC,KAAK,CAAC;MACjB;IACJ;IACA,IAAIJ,OAAO,CAACK,mBAAmB,CAACC,MAAM,KAAK,CAAC,EAAE;MAC1CF,UAAU,CAAC,KAAK,CAAC;MACjBF,WAAW,CAAC,EAAE,CAAC;MACf;IACJ;IACA,IAAMK,WAAW,GAAGP,OAAO,CAACK,mBAAmB,CAACG,GAAG,CAAC,UAACC,MAAM;MAAA,OAAKA,MAAM,CAACC,UAAU;IAAA,EAAC;IAClF,IAAMC,WAAW,GAAGf,SAAS,EAAE,CAC1BgB,UAAU,CAAC,WAAW,CAAC,CACvBC,KAAK,CAACjB,SAAS,CAACkB,SAAS,CAACC,UAAU,EAAE,EAAE,IAAI,EAAER,WAAW,CAAC,CAC1DS,UAAU,CACP,UAACC,aAAa,EAAK;MACf,IAAMC,IAAe,GAAG,EAAE;MAC1BD,aAAa,CAACE,OAAO,CAAC,UAACC,GAAG,EAAK;QAC3BF,IAAI,CAACG,IAAI;UACLC,EAAE,EAAEF,GAAG,CAACE;QAAE,GACPF,GAAG,CAACG,IAAI,EAAE,EACf;MACN,CAAC,CAAC;MACFrB,WAAW,CAACgB,IAAI,CAAe;MAC/Bd,UAAU,CAAC,KAAK,CAAC;IACrB,CAAC,EACD,UAACoB,KAAK,EAAK;MACPpB,UAAU,CAAC,KAAK,CAAC;MACjBL,OAAO,IAAIA,OAAO,CAAC,0BAA0B,CAAC;MAC9C0B,OAAO,CAACC,GAAG,CAAC,mCAAmC,EAAEF,KAAK,CAAC;IAC3D,CAAC,CAAC;IACV,OAAOb,WAAW;EACtB,CAAC,EAAC,CAACX,OAAO,oBAAPA,OAAO,CAAEK,mBAAmB,CAAC,CAAC;EACjC,OAAO;IACHJ,QAAQ,EAARA,QAAQ;IACRE,OAAO,EAAPA;EACJ,CAAC;AACL"},"metadata":{},"sourceType":"module"}