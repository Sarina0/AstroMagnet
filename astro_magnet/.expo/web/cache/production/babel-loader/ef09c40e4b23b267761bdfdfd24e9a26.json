{"ast":null,"code":"import _asyncToGenerator from\"@babel/runtime/helpers/asyncToGenerator\";import _slicedToArray from\"@babel/runtime/helpers/slicedToArray\";import{NativeWindStyleSheet as _NativeWindStyleSheet}from\"nativewind\";import{useState,useContext}from'react';import{UserContext}from\"../../../context/user\";import StyleSheet from\"react-native-web/dist/exports/StyleSheet\";import View from\"react-native-web/dist/exports/View\";import ScrollView from\"react-native-web/dist/exports/ScrollView\";import PageHeader from\"../../components/global/header\";import{User}from\"../../../shared/interfaces/user\";import{UploadController}from\"../../../controller/upload\";import UserController from\"../../../controller/user\";import{signOut}from\"../../../controller/auth\";import RoundButton from\"../../components/global/RoundButton\";import LoadingOverlay from\"../../components/LoadingOverlay\";import SafeArea from\"../../components/global/safeArea\";import Input from\"../../components/global/input\";import Select from\"../../components/global/select\";import MultiSelect from\"../../components/global/multiSelect\";import ImagePicker from\"../../components/global/imagePicker\";import DatePicker from\"../../components/global/datepicker\";import{validateUser}from\"../../../shared/actions/validation\";import ToastDialog from\"../../components/global/toast\";import{useToast}from'native-base';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var ProfileScreen=function ProfileScreen(){var _currentUser$dateAndT,_currentUser$name,_currentUser$sex,_currentUser$interest,_currentUser$placeOfB;var _useContext=useContext(UserContext),currentUser=_useContext.profile,authUser=_useContext.authUser;var _useState=useState((_currentUser$dateAndT=currentUser==null?void 0:currentUser.dateAndTimeOfBirth)!=null?_currentUser$dateAndT:null),_useState2=_slicedToArray(_useState,2),date=_useState2[0],setDate=_useState2[1];var _useState3=useState((_currentUser$name=currentUser==null?void 0:currentUser.name)!=null?_currentUser$name:\"\"),_useState4=_slicedToArray(_useState3,2),name=_useState4[0],setName=_useState4[1];var _useState5=useState((_currentUser$sex=currentUser==null?void 0:currentUser.sex)!=null?_currentUser$sex:null),_useState6=_slicedToArray(_useState5,2),sex=_useState6[0],setSex=_useState6[1];var _useState7=useState((_currentUser$interest=currentUser==null?void 0:currentUser.interestedType)!=null?_currentUser$interest:[]),_useState8=_slicedToArray(_useState7,2),interest=_useState8[0],setInterest=_useState8[1];var _useState9=useState((_currentUser$placeOfB=currentUser==null?void 0:currentUser.placeOfBirth)!=null?_currentUser$placeOfB:\"\"),_useState10=_slicedToArray(_useState9,2),birthPlace=_useState10[0],setBirthPlace=_useState10[1];var _useState11=useState(undefined),_useState12=_slicedToArray(_useState11,2),updatedPic=_useState12[0],setUpdatedPic=_useState12[1];var _useState13=useState(false),_useState14=_slicedToArray(_useState13,2),loading=_useState14[0],setLoading=_useState14[1];var toast=useToast();var selectItems=User.sexes.map(function(sex){return{label:sex,value:sex};});var onUploadImage=function(){var _ref=_asyncToGenerator(function*(){setLoading(true);if(!updatedPic){return currentUser==null?void 0:currentUser.profilePicture;}var url=yield UploadController.uploadImage({uri:updatedPic,name:authUser==null?void 0:authUser.uid}).catch(function(error){toast.show({render:function render(){return _jsx(ToastDialog,{message:error.message});}});setLoading(false);});return url;});return function onUploadImage(){return _ref.apply(this,arguments);};}();var onSaveProfile=function(){var _ref2=_asyncToGenerator(function*(){var updatedImgURL=yield onUploadImage();if(typeof updatedImgURL!==\"string\"){return;}var data={dateAndTimeOfBirth:date,interestedType:interest,name:name,placeOfBirth:birthPlace,profilePicture:updatedImgURL,sex:sex};if(!validateUser(data,function(error){toast.show({render:function render(){return _jsx(ToastDialog,{message:error});}});})){setLoading(false);return;}yield UserController.updateUser(currentUser==null?void 0:currentUser.id,data,function(error){toast.show({render:function render(){return _jsx(ToastDialog,{message:error});}});});setLoading(false);});return function onSaveProfile(){return _ref2.apply(this,arguments);};}();return _jsxs(SafeArea,{children:[_jsx(ScrollView,{style:{flex:1},children:_jsxs(View,{style:styles.container,children:[_jsx(PageHeader,{}),_jsxs(View,{style:styles.form,children:[_jsx(ImagePicker,{fallback:currentUser==null?void 0:currentUser.profilePicture,value:updatedPic,onChange:function onChange(value){return setUpdatedPic(value);},labelStyle:{marginTop:20},style:{marginVertical:10},mode:\"avatar\"}),_jsx(Input,{label:\"Name\",value:name,onChangeText:function onChangeText(text){return setName(text);},placeholder:\"Enter your name\",style:{marginTop:20}}),_jsx(Select,{label:\"Sex\",value:sex,onValueChange:function onValueChange(value){return setSex(value);},items:selectItems,style:[styles.extraStyle,{width:\"50%\"}],placeholder:\"Select your sex\"}),_jsx(Input,{label:\"Birth Place\",value:birthPlace,onChangeText:function onChangeText(text){return setBirthPlace(text);},placeholder:\"Enter your birth place\",style:styles.extraStyle}),_jsx(MultiSelect,{label:\"Interested In\",value:interest,onValueChange:function onValueChange(selected){return setInterest(selected);},items:selectItems,placeholder:\"Who are you interested in?\",style:styles.extraStyle}),_jsx(DatePicker,{label:\"Date of Birth\",value:date,onChange:function onChange(value){return setDate(value);},style:styles.extraStyle}),_jsx(RoundButton,{style:styles.extraStyle,title:\"update\",onPress:onSaveProfile}),_jsx(RoundButton,{style:styles.extraStyle,title:\"sign out\",onPress:signOut})]})]})}),loading&&_jsx(LoadingOverlay,{})]});};export default ProfileScreen;var styles=StyleSheet.create({container:{flex:1},form:{padding:10,paddingLeft:30,flexDirection:\"column\"},extraStyle:{marginTop:20}});_NativeWindStyleSheet.create({styles:{\"container\":{\"width\":\"100%\"},\"container@0\":{\"maxWidth\":640},\"container@1\":{\"maxWidth\":768},\"container@2\":{\"maxWidth\":1024},\"container@3\":{\"maxWidth\":1280},\"container@4\":{\"maxWidth\":1536},\"flex\":{\"display\":\"flex\"}},atRules:{\"container\":[[[\"media\",\"(min-width: 640px)\"]],[[\"media\",\"(min-width: 768px)\"]],[[\"media\",\"(min-width: 1024px)\"]],[[\"media\",\"(min-width: 1280px)\"]],[[\"media\",\"(min-width: 1536px)\"]]]},topics:{\"container\":[\"width\"]}});","map":{"version":3,"names":["useState","useContext","UserContext","PageHeader","User","UploadController","UserController","signOut","RoundButton","LoadingOverlay","SafeArea","Input","Select","MultiSelect","ImagePicker","DatePicker","validateUser","ToastDialog","useToast","ProfileScreen","currentUser","profile","authUser","dateAndTimeOfBirth","date","setDate","name","setName","sex","setSex","interestedType","interest","setInterest","placeOfBirth","birthPlace","setBirthPlace","undefined","updatedPic","setUpdatedPic","loading","setLoading","toast","selectItems","sexes","map","label","value","onUploadImage","profilePicture","url","uploadImage","uri","uid","catch","error","show","render","message","onSaveProfile","updatedImgURL","data","updateUser","id","flex","styles","container","form","marginTop","marginVertical","text","extraStyle","width","selected","StyleSheet","create","padding","paddingLeft","flexDirection"],"sources":["/Users/sonminhnguyen/Documents/programming/react-native/school/astro_magnet_initial/astro_magnet/src/frontend/screens/profile/index.tsx"],"sourcesContent":["import { useState, useContext } from 'react';\nimport {UserContext} from '@app/context/user';\nimport { StyleSheet, View, ScrollView, ViewStyle } from 'react-native'\nimport PageHeader from '@app/frontend/components/global/header'\nimport { User } from '@app/shared/interfaces/user'\nimport { UploadController } from \"@app/controller/upload\";\nimport UserController from \"@app/controller/user\";\nimport { signOut } from '@app/controller/auth';\nimport RoundButton from \"@app/frontend/components/global/RoundButton\";\nimport LoadingOverlay from \"@app/frontend/components/LoadingOverlay\";\nimport SafeArea from '@app/frontend/components/global/safeArea';\nimport Input from \"@app/frontend/components/global/input\";\nimport Select from \"@app/frontend/components/global/select\";\nimport MultiSelect from '@app/frontend/components/global/multiSelect';\nimport ImagePicker from '@app/frontend/components/global/imagePicker';\nimport DatePicker from '@app/frontend/components/global/datepicker';\nimport { validateUser } from '@app/shared/actions/validation';\nimport ToastDialog from '@app/frontend/components/global/toast';\nimport { useToast } from 'native-base';\n\nconst ProfileScreen = () => {\n    const {\n        profile: currentUser,\n        authUser\n    } = useContext(UserContext);\n    const [date, setDate] = useState<Date|null>(\n        currentUser?.dateAndTimeOfBirth ?? null\n    );\n    const [ name, setName ] = useState<string>(\n        currentUser?.name ?? \"\"\n    )\n    const [ sex, setSex ] = useState<User.SexType|null>(\n        currentUser?.sex ?? null\n    )\n    const [ interest, setInterest ] = useState<User.SexType[]>(\n        currentUser?.interestedType ?? []\n    )\n    const [ birthPlace, setBirthPlace ] = useState<string>(\n        currentUser?.placeOfBirth ?? \"\"\n    )\n    const [ updatedPic, setUpdatedPic] = useState<string | null | undefined>(\n        undefined\n    );\n    const [ loading, setLoading ] = useState(false);\n    const toast = useToast();\n\n    //list of items for select components\n    const selectItems = User.sexes.map(sex=>({\n        label: sex,\n        value: sex\n    }))\n\n    /**\n     * upload image to firebase storage\n     */\n    const onUploadImage = async () => {\n        setLoading(true);\n        if (!updatedPic) {\n            return currentUser?.profilePicture;\n        }\n        const url = await UploadController.uploadImage({\n            uri: updatedPic,\n            name: authUser?.uid,\n        })\n        .catch((error)=>{\n            toast.show({\n                render: () => <ToastDialog message={error.message} />\n            });\n            setLoading(false);\n        });\n        return url;\n    }\n\n    /**\n     * update user profile in firestore\n     */\n    const onSaveProfile = async () => {\n\n        //upload image if updated and get the new image url\n        const updatedImgURL = await onUploadImage();\n\n        //guard against image upload failed\n        if (typeof updatedImgURL !== \"string\") {\n            return;\n        }\n\n        //place all the data into a single object to prepare for update\n        const data = {\n            dateAndTimeOfBirth: date,\n            interestedType: interest,\n            name,\n            placeOfBirth: birthPlace,\n            profilePicture: updatedImgURL,\n            sex\n        };\n\n        //guard against invalid data\n        if (!validateUser(data, (error)=> {\n            toast.show({\n                render: () => <ToastDialog message={error} />\n            });\n        })) {\n            setLoading(false);\n            return;\n        }\n\n        //update user profile\n        await UserController.updateUser(\n            currentUser?.id!, \n            data,\n            (error)=>{\n                toast.show({\n                    render: () => <ToastDialog message={error} />\n                });\n            }\n        );\n        setLoading(false);\n    }\n\n    return (\n        <SafeArea>\n            <ScrollView style={{flex: 1}}>\n                <View\n                    style = { styles.container }\n                >\n                    <PageHeader />\n                    <View\n                        style = { styles.form }\n                    >\n                        <ImagePicker\n                            fallback={currentUser?.profilePicture}\n                            value={updatedPic}\n                            onChange={(value)=>setUpdatedPic(value)} \n                            labelStyle={{marginTop: 20}}\n                            style={{marginVertical: 10}}\n                            mode=\"avatar\"\n                        />\n                        <Input\n                            label = \"Name\"\n                            value = { name }\n                            onChangeText = { (text) => setName(text) }\n                            placeholder = \"Enter your name\"\n                            style={{marginTop: 20}}\n                        />\n                        <Select\n                            label = \"Sex\"\n                            value= {sex}\n                            onValueChange = { \n                                (value) => setSex(value as User.SexType) \n                            }\n                            items={selectItems}\n                            style={[styles.extraStyle, {width: \"50%\"}]}\n                            placeholder=\"Select your sex\"\n                        />\n                        <Input\n                            label = \"Birth Place\"\n                            value = { birthPlace }\n                            onChangeText = { (text) => setBirthPlace(text) }\n                            placeholder = \"Enter your birth place\"\n                            style={styles.extraStyle}\n                        />\n                        <MultiSelect\n                            label = \"Interested In\"\n                            value = { interest }\n                            onValueChange = { \n                                (selected) => setInterest(selected as User.SexType[]) \n                            }\n                            items={selectItems}\n                            placeholder = \"Who are you interested in?\"\n                            style={styles.extraStyle}\n                        />\n                        <DatePicker\n                            label = \"Date of Birth\"\n                            value = { date }\n                            onChange = { (value)=> setDate(value) }\n                            style={styles.extraStyle}\n                        />\n                        <RoundButton\n                            style={styles.extraStyle}\n                            title=\"update\"\n                            onPress={onSaveProfile}\n                        />\n                        <RoundButton\n                            style={styles.extraStyle}\n                            title=\"sign out\"\n                            onPress={signOut}\n                        />\n                    </View>\n                </View>\n            </ScrollView>\n            {loading && <LoadingOverlay />}\n        </SafeArea>\n    )\n}\n\nexport default ProfileScreen\n\nconst styles = StyleSheet.create({\n    container: {\n        flex: 1\n    },\n    form: {\n        padding: 10,\n        paddingLeft: 30,\n        flexDirection: \"column\",\n    },\n    extraStyle: {\n        marginTop: 20,\n    }\n})\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}