{"ast":null,"code":"import _defineProperty from\"@babel/runtime/helpers/defineProperty\";import _objectWithoutProperties from\"@babel/runtime/helpers/objectWithoutProperties\";import _classCallCheck from\"@babel/runtime/helpers/classCallCheck\";import _createClass from\"@babel/runtime/helpers/createClass\";import _inherits from\"@babel/runtime/helpers/inherits\";import _possibleConstructorReturn from\"@babel/runtime/helpers/possibleConstructorReturn\";import _getPrototypeOf from\"@babel/runtime/helpers/getPrototypeOf\";var _excluded=[\"contentContainerStyle\",\"threshold\",\"showScrollToEndIndicator\",\"showNewItemAlert\",\"newItemAlertRenderer\",\"indicatorContainerStyle\",\"indicatorComponent\",\"numColumns\"];function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;})),keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach(function(key){_defineProperty(target,key,source[key]);}):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}return target;}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return _possibleConstructorReturn(this,result);};}function _isNativeReflectConstruct(){if(typeof Reflect===\"undefined\"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy===\"function\")return true;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}));return true;}catch(e){return false;}}import React from\"react\";import Animated from\"react-native-web/dist/exports/Animated\";import FlatList from\"react-native-web/dist/exports/FlatList\";import StyleSheet from\"react-native-web/dist/exports/StyleSheet\";import Text from\"react-native-web/dist/exports/Text\";import TouchableWithoutFeedback from\"react-native-web/dist/exports/TouchableWithoutFeedback\";import View from\"react-native-web/dist/exports/View\";import{Triangle}from\"./Triangle\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{createElement as _createElement}from\"react\";export var AutoScrollFlatList=function(_React$PureComponent){_inherits(AutoScrollFlatList,_React$PureComponent);var _super=_createSuper(AutoScrollFlatList);function AutoScrollFlatList(props){var _this;_classCallCheck(this,AutoScrollFlatList);_this=_super.call(this,props);_this.listRef=React.createRef();_this.flatListHeight=0;_this.flatListWidth=0;_this.contentHeight=0;_this.contentWidth=0;_this.scrollTop=0;_this.scrollToEnd=function(){var params=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{animated:true};var offset=_this.props.horizontal?_this.contentWidth-_this.flatListWidth:_this.contentHeight-_this.flatListHeight;_this.setState({newItemCount:0});_this.scrollToOffset({offset:offset,animated:params.animated});};_this.scrollToIndex=function(params){var _this$listRef$current;(_this$listRef$current=_this.listRef.current)==null?void 0:_this$listRef$current.scrollToIndex(params);};_this.scrollToItem=function(params){var _this$listRef$current2;(_this$listRef$current2=_this.listRef.current)==null?void 0:_this$listRef$current2.scrollToItem(params);};_this.scrollToOffset=function(params){var _this$listRef$current3;(_this$listRef$current3=_this.listRef.current)==null?void 0:_this$listRef$current3.scrollToOffset(params);};_this.recordInteraction=function(){var _this$listRef$current4;(_this$listRef$current4=_this.listRef.current)==null?void 0:_this$listRef$current4.recordInteraction();};_this.flashScrollIndicators=function(){var _this$listRef$current5;(_this$listRef$current5=_this.listRef.current)==null?void 0:_this$listRef$current5.flashScrollIndicators();};_this.getScrollableNode=function(){var _this$listRef$current6;return(_this$listRef$current6=_this.listRef.current)==null?void 0:_this$listRef$current6.getScrollableNode();};_this.getNativeScrollRef=function(){var _this$listRef$current7;return(_this$listRef$current7=_this.listRef.current)==null?void 0:_this$listRef$current7.getNativeScrollRef();};_this.getScrollResponder=function(){var _this$listRef$current8;return(_this$listRef$current8=_this.listRef.current)==null?void 0:_this$listRef$current8.getScrollResponder();};_this.isAutoScrolling=function(){return _this.state.enabledAutoScrollToEnd;};_this.getTriangleDirection=function(){var _this$props=_this.props,inverted=_this$props.inverted,horizontal=_this$props.horizontal,triangleDirection=_this$props.triangleDirection;var direction;if(horizontal){if(inverted){direction=\"left\";}else{direction=\"right\";}}else{if(inverted){direction=\"up\";}else{direction=\"down\";}}return triangleDirection!=null?triangleDirection:direction;};_this.getScrollToEndIndicatorPosition=function(){var _this$props2=_this.props,inverted=_this$props2.inverted,horizontal=_this$props2.horizontal;return{top:inverted&&!horizontal?20:undefined,bottom:inverted&&!horizontal?undefined:20,left:inverted&&horizontal?30:undefined,right:inverted&&horizontal?undefined:20};};_this.onLayout=function(event){_this.flatListHeight=event.nativeEvent.layout.height;_this.flatListWidth=event.nativeEvent.layout.width;if(_this.listRef.current&&_this.state.enabledAutoScrollToEnd){_this.scrollToEnd();}_this.props.onLayout==null?void 0:_this.props.onLayout(event);};_this.onContentSizeChange=function(width,height){_this.contentHeight=height;_this.contentWidth=width;if(_this.state.enabledAutoScrollToEnd){_this.scrollToEnd();}_this.props.onContentSizeChange==null?void 0:_this.props.onContentSizeChange(width,height);};_this.onScroll=function(event){var prevScrollTop=_this.scrollTop;_this.scrollTop=_this.props.horizontal?event.nativeEvent.contentOffset.x:event.nativeEvent.contentOffset.y;var isScrollingDown=prevScrollTop<=_this.scrollTop;var scrollEnd=_this.props.horizontal?_this.contentWidth-_this.flatListWidth:_this.contentHeight-_this.flatListHeight;var isEndOfList=_this.scrollTop+_this.props.threshold>=Math.floor(scrollEnd);_this.setState({isEndOfList:isEndOfList,enabledAutoScrollToEnd:_this.props.autoScrollDisabled?false:_this.state.enabledAutoScrollToEnd&&isScrollingDown||isEndOfList},function(){_this.props.onScroll==null?void 0:_this.props.onScroll(event);});event.persist==null?void 0:event.persist();};_this.renderDefaultNewItemAlertComponent=function(newItemCount,translateY){var _this$props3=_this.props,inverted=_this$props3.inverted,horizontal=_this$props3.horizontal,newItemAlertMessage=_this$props3.newItemAlertMessage,newItemAlertContainerStyle=_this$props3.newItemAlertContainerStyle,newItemAlertTextStyle=_this$props3.newItemAlertTextStyle;var direction=_this.getTriangleDirection();var message=newItemAlertMessage?newItemAlertMessage(newItemCount):\"\"+(direction===\"left\"?\" \":\"\")+newItemCount+\" new item\"+(newItemCount>1?\"s\":\"\");var position=inverted&&!horizontal?{bottom:translateY}:{top:translateY};return _jsxs(Animated.View,{style:[styles.newItemAlert,newItemAlertContainerStyle,position],children:[direction===\"left\"&&_jsx(Triangle,{size:4,direction:direction}),_jsx(Text,{style:[styles.alertMessage,newItemAlertTextStyle],children:message}),direction!==\"left\"&&_jsx(Triangle,{size:4,direction:direction})]});};_this.renderDefaultIndicatorComponent=function(){var indicatorContainerStyle=_this.props.indicatorContainerStyle;return _jsx(View,{style:indicatorContainerStyle!=null?indicatorContainerStyle:[styles.scrollToEndIndicator,_this.getScrollToEndIndicatorPosition()],children:_jsx(Triangle,{direction:_this.getTriangleDirection()})});};_this.state={enabledAutoScrollToEnd:props.autoScrollDisabled?false:true,newItemCount:0,alertY:new Animated.Value(0),isEndOfList:true};return _this;}_createClass(AutoScrollFlatList,[{key:\"componentDidUpdate\",value:function componentDidUpdate(prevProps,prevState){var _prevProps$data,_prevProps$data2;var _this$props4=this.props,data=_this$props4.data,filteredDataForNewItemCount=_this$props4.filteredDataForNewItemCount;var _this$state=this.state,enabledAutoScrollToEnd=_this$state.enabledAutoScrollToEnd,newItemCount=_this$state.newItemCount,alertY=_this$state.alertY;var filteredPrevData=filteredDataForNewItemCount?filteredDataForNewItemCount((_prevProps$data=prevProps.data)!=null?_prevProps$data:[]):(_prevProps$data2=prevProps.data)!=null?_prevProps$data2:[];var filteredData=filteredDataForNewItemCount?filteredDataForNewItemCount(data!=null?data:[]):data!=null?data:[];if(!enabledAutoScrollToEnd&&filteredData.length>filteredPrevData.length){var newCount=prevState.newItemCount+filteredData.length-filteredPrevData.length;this.setState({newItemCount:newCount});if(newCount===1){alertY.setValue(-30);Animated.timing(alertY,{toValue:10,duration:250,useNativeDriver:false}).start();}}else if(enabledAutoScrollToEnd&&newItemCount){this.setState({newItemCount:0});}}},{key:\"render\",value:function render(){var _this2=this;var _this$props5=this.props,contentContainerStyle=_this$props5.contentContainerStyle,threshold=_this$props5.threshold,showScrollToEndIndicator=_this$props5.showScrollToEndIndicator,showNewItemAlert=_this$props5.showNewItemAlert,newItemAlertRenderer=_this$props5.newItemAlertRenderer,indicatorContainerStyle=_this$props5.indicatorContainerStyle,indicatorComponent=_this$props5.indicatorComponent,numColumns=_this$props5.numColumns,restProps=_objectWithoutProperties(_this$props5,_excluded);var _this$state2=this.state,enabledAutoScrollToEnd=_this$state2.enabledAutoScrollToEnd,newItemCount=_this$state2.newItemCount,alertY=_this$state2.alertY,isEndOfList=_this$state2.isEndOfList;return _jsxs(View,{style:styles.container,children:[_createElement(FlatList,_objectSpread(_objectSpread({},restProps),{},{ref:this.listRef,key:numColumns,numColumns:numColumns,contentContainerStyle:contentContainerStyle!=null?contentContainerStyle:styles.contentContainer,onLayout:this.onLayout,onContentSizeChange:this.onContentSizeChange,onScroll:this.onScroll})),showNewItemAlert&&!enabledAutoScrollToEnd&&newItemCount>0&&_jsx(TouchableWithoutFeedback,{onPress:function onPress(){return _this2.scrollToEnd();},children:newItemAlertRenderer?newItemAlertRenderer(newItemCount,alertY):this.renderDefaultNewItemAlertComponent(newItemCount,alertY)}),showScrollToEndIndicator&&!enabledAutoScrollToEnd&&!isEndOfList&&_jsx(TouchableWithoutFeedback,{onPress:function onPress(){return _this2.scrollToEnd();},children:indicatorComponent!=null?indicatorComponent:this.renderDefaultIndicatorComponent()})]});}}]);return AutoScrollFlatList;}(React.PureComponent);AutoScrollFlatList.displayName=\"AutoScrollFlatList\";AutoScrollFlatList.defaultProps={threshold:0,showScrollToEndIndicator:true,showNewItemAlert:true,autoScrollDisabled:false};var styles=StyleSheet.create({container:{flex:1,overflow:\"hidden\"},contentContainer:{alignItems:\"stretch\",paddingVertical:8,paddingHorizontal:8},scrollToEndIndicator:{position:\"absolute\",width:30,height:30,justifyContent:\"center\",alignItems:\"center\",borderWidth:1,borderColor:\"#000000\",borderRadius:5,backgroundColor:\"#ffffff\"},newItemAlert:{position:\"absolute\",alignSelf:\"center\",flexDirection:\"row\",alignItems:\"center\",borderRadius:10,borderWidth:StyleSheet.hairlineWidth,borderColor:\"#000000\",backgroundColor:\"#ffffff\",paddingVertical:3,paddingHorizontal:8},alertMessage:{marginRight:4}});","map":{"version":3,"sources":["../../../src/component/AutoScrollFlatList.tsx"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["import React from \"react\";\nimport { Animated, FlatList, StyleSheet, Text, TouchableWithoutFeedback, View } from \"react-native\";\nimport { Triangle } from \"./Triangle\";\nexport class AutoScrollFlatList extends React.PureComponent {\n    constructor(props) {\n        super(props);\n        this.listRef = React.createRef();\n        this.flatListHeight = 0;\n        this.flatListWidth = 0;\n        this.contentHeight = 0;\n        this.contentWidth = 0;\n        this.scrollTop = 0;\n        /**\n         *  Exposing FlatList Methods To AutoScrollFlatList's Ref\n         */\n        this.scrollToEnd = (params = { animated: true }) => {\n            const offset = this.props.horizontal ? this.contentWidth - this.flatListWidth : this.contentHeight - this.flatListHeight;\n            this.setState({ newItemCount: 0 });\n            this.scrollToOffset({ offset, animated: params.animated });\n        };\n        this.scrollToIndex = (params) => {\n            this.listRef.current?.scrollToIndex(params);\n        };\n        this.scrollToItem = (params) => {\n            this.listRef.current?.scrollToItem(params);\n        };\n        this.scrollToOffset = (params) => {\n            this.listRef.current?.scrollToOffset(params);\n        };\n        this.recordInteraction = () => {\n            this.listRef.current?.recordInteraction();\n        };\n        this.flashScrollIndicators = () => {\n            this.listRef.current?.flashScrollIndicators();\n        };\n        this.getScrollableNode = () => {\n            return this.listRef.current?.getScrollableNode();\n        };\n        this.getNativeScrollRef = () => {\n            return this.listRef.current?.getNativeScrollRef();\n        };\n        this.getScrollResponder = () => {\n            return this.listRef.current?.getScrollResponder();\n        };\n        this.isAutoScrolling = () => this.state.enabledAutoScrollToEnd;\n        /**\n         * Private Methods\n         */\n        this.getTriangleDirection = () => {\n            const { inverted, horizontal, triangleDirection } = this.props;\n            let direction;\n            if (horizontal) {\n                if (inverted) {\n                    direction = \"left\";\n                }\n                else {\n                    direction = \"right\";\n                }\n            }\n            else {\n                if (inverted) {\n                    direction = \"up\";\n                }\n                else {\n                    direction = \"down\";\n                }\n            }\n            return triangleDirection ?? direction;\n        };\n        this.getScrollToEndIndicatorPosition = () => {\n            const { inverted, horizontal } = this.props;\n            return {\n                top: inverted && !horizontal ? 20 : undefined,\n                bottom: inverted && !horizontal ? undefined : 20,\n                left: inverted && horizontal ? 30 : undefined,\n                right: inverted && horizontal ? undefined : 20,\n            };\n        };\n        this.onLayout = (event) => {\n            this.flatListHeight = event.nativeEvent.layout.height;\n            this.flatListWidth = event.nativeEvent.layout.width;\n            if (this.listRef.current && this.state.enabledAutoScrollToEnd) {\n                this.scrollToEnd();\n            }\n            // User-defined onLayout event\n            this.props.onLayout?.(event);\n        };\n        this.onContentSizeChange = (width, height) => {\n            this.contentHeight = height;\n            this.contentWidth = width;\n            if (this.state.enabledAutoScrollToEnd) {\n                this.scrollToEnd();\n            }\n            // User-defined onContentSizeChange event\n            this.props.onContentSizeChange?.(width, height);\n        };\n        this.onScroll = (event) => {\n            /**\n             *  Default behavior: if scrollTop is at the end of <Flatlist>, autoscroll will be enabled.\n             *  CAVEAT: Android has precision error here from 4 decimal places, therefore we need to use Math.floor() to make sure the calculation is correct on Android.\n             */\n            const prevScrollTop = this.scrollTop;\n            this.scrollTop = this.props.horizontal ? event.nativeEvent.contentOffset.x : event.nativeEvent.contentOffset.y;\n            const isScrollingDown = prevScrollTop <= this.scrollTop;\n            const scrollEnd = this.props.horizontal ? this.contentWidth - this.flatListWidth : this.contentHeight - this.flatListHeight;\n            const isEndOfList = this.scrollTop + this.props.threshold >= Math.floor(scrollEnd);\n            this.setState({ isEndOfList, enabledAutoScrollToEnd: this.props.autoScrollDisabled ? false : (this.state.enabledAutoScrollToEnd && isScrollingDown) || isEndOfList }, () => {\n                // User-defined onScroll event\n                this.props.onScroll?.(event);\n            });\n            /**\n             * Need to check if event.persist is defined before using to account for usage in react-native-web\n             */\n            event.persist?.();\n        };\n        this.renderDefaultNewItemAlertComponent = (newItemCount, translateY) => {\n            const { inverted, horizontal, newItemAlertMessage, newItemAlertContainerStyle, newItemAlertTextStyle } = this.props;\n            const direction = this.getTriangleDirection();\n            const message = newItemAlertMessage ? newItemAlertMessage(newItemCount) : `${direction === \"left\" ? \" \" : \"\"}${newItemCount} new item${newItemCount > 1 ? \"s\" : \"\"}`;\n            const position = inverted && !horizontal ? { bottom: translateY } : { top: translateY };\n            return (<Animated.View style={[styles.newItemAlert, newItemAlertContainerStyle, position]}>\n                {direction === \"left\" && <Triangle size={4} direction={direction}/>}\n                <Text style={[styles.alertMessage, newItemAlertTextStyle]}>{message}</Text>\n                {direction !== \"left\" && <Triangle size={4} direction={direction}/>}\n            </Animated.View>);\n        };\n        this.renderDefaultIndicatorComponent = () => {\n            const { indicatorContainerStyle } = this.props;\n            return (<View style={indicatorContainerStyle ?? [styles.scrollToEndIndicator, this.getScrollToEndIndicatorPosition()]}>\n                <Triangle direction={this.getTriangleDirection()}/>\n            </View>);\n        };\n        this.state = {\n            enabledAutoScrollToEnd: props.autoScrollDisabled ? false : true,\n            newItemCount: 0,\n            alertY: new Animated.Value(0),\n            isEndOfList: true,\n        };\n    }\n    componentDidUpdate(prevProps, prevState) {\n        const { data, filteredDataForNewItemCount } = this.props;\n        const { enabledAutoScrollToEnd, newItemCount, alertY } = this.state;\n        const filteredPrevData = filteredDataForNewItemCount ? filteredDataForNewItemCount(prevProps.data ?? []) : prevProps.data ?? [];\n        const filteredData = filteredDataForNewItemCount ? filteredDataForNewItemCount(data ?? []) : data ?? [];\n        if (!enabledAutoScrollToEnd && filteredData.length > filteredPrevData.length) {\n            const newCount = prevState.newItemCount + filteredData.length - filteredPrevData.length;\n            this.setState({ newItemCount: newCount });\n            if (newCount === 1) {\n                alertY.setValue(-30);\n                Animated.timing(alertY, {\n                    toValue: 10,\n                    duration: 250,\n                    useNativeDriver: false,\n                }).start();\n            }\n        }\n        else if (enabledAutoScrollToEnd && newItemCount) {\n            this.setState({ newItemCount: 0 });\n        }\n    }\n    render() {\n        /**\n         * Need to force a refresh for the FlatList by changing the key when numColumns changes.\n         * Ref: https://stackoverflow.com/questions/44291781/dynamically-changing-number-of-columns-in-react-native-flat-list\n         */\n        const { contentContainerStyle, threshold, showScrollToEndIndicator, showNewItemAlert, newItemAlertRenderer, indicatorContainerStyle, indicatorComponent, numColumns, ...restProps } = this.props;\n        const { enabledAutoScrollToEnd, newItemCount, alertY, isEndOfList } = this.state;\n        return (<View style={styles.container}>\n                <FlatList {...restProps} ref={this.listRef} key={numColumns} numColumns={numColumns} contentContainerStyle={contentContainerStyle ?? styles.contentContainer} onLayout={this.onLayout} onContentSizeChange={this.onContentSizeChange} onScroll={this.onScroll}/>\n                {showNewItemAlert && !enabledAutoScrollToEnd && newItemCount > 0 && (<TouchableWithoutFeedback onPress={() => this.scrollToEnd()}>{newItemAlertRenderer ? newItemAlertRenderer(newItemCount, alertY) : this.renderDefaultNewItemAlertComponent(newItemCount, alertY)}</TouchableWithoutFeedback>)}\n                {showScrollToEndIndicator && !enabledAutoScrollToEnd && !isEndOfList && <TouchableWithoutFeedback onPress={() => this.scrollToEnd()}>{indicatorComponent ?? this.renderDefaultIndicatorComponent()}</TouchableWithoutFeedback>}\n            </View>);\n    }\n}\nAutoScrollFlatList.displayName = \"AutoScrollFlatList\";\nAutoScrollFlatList.defaultProps = {\n    threshold: 0,\n    showScrollToEndIndicator: true,\n    showNewItemAlert: true,\n    autoScrollDisabled: false,\n};\nconst styles = StyleSheet.create({\n    container: {\n        flex: 1,\n        overflow: \"hidden\",\n    },\n    contentContainer: {\n        alignItems: \"stretch\",\n        paddingVertical: 8,\n        paddingHorizontal: 8,\n    },\n    scrollToEndIndicator: {\n        position: \"absolute\",\n        width: 30,\n        height: 30,\n        justifyContent: \"center\",\n        alignItems: \"center\",\n        borderWidth: 1,\n        borderColor: \"#000000\",\n        borderRadius: 5,\n        backgroundColor: \"#ffffff\",\n    },\n    newItemAlert: {\n        position: \"absolute\",\n        alignSelf: \"center\",\n        flexDirection: \"row\",\n        alignItems: \"center\",\n        borderRadius: 10,\n        borderWidth: StyleSheet.hairlineWidth,\n        borderColor: \"#000000\",\n        backgroundColor: \"#ffffff\",\n        paddingVertical: 3,\n        paddingHorizontal: 8,\n    },\n    alertMessage: {\n        marginRight: 4,\n    },\n});\n//# sourceMappingURL=AutoScrollFlatList.js.map"]},"metadata":{},"sourceType":"module"}