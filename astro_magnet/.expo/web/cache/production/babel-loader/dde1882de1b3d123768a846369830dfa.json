{"ast":null,"code":"import _defineProperty from\"@babel/runtime/helpers/defineProperty\";import _slicedToArray from\"@babel/runtime/helpers/slicedToArray\";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;})),keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach(function(key){_defineProperty(target,key,source[key]);}):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}return target;}import{useState,useEffect}from\"react\";import firestore from\"@react-native-firebase/firestore\";import useAuthState from\"./useAuthState\";export default function useProfile(onError){var _useAuthState=useAuthState(),user=_useAuthState.user,status=_useAuthState.status;var _useState=useState(null),_useState2=_slicedToArray(_useState,2),userProfile=_useState2[0],setUserProfile=_useState2[1];var _useState3=useState(true),_useState4=_slicedToArray(_useState3,2),profileLoading=_useState4[0],setProfileLoading=_useState4[1];useEffect(function(){if(status===\"loading\")return;if(user){setProfileLoading(true);console.log(\"[LOG] profile loading\");var unsubscribe=firestore().collection('users').where(\"email\",\"==\",user.email).onSnapshot(function(documentSnapShot){if(documentSnapShot&&documentSnapShot.docs.length>0){var rawDob=documentSnapShot.docs[0].data().dateAndTimeOfBirth;var dateOfBirth=rawDob?rawDob.toDate():null;setUserProfile(_objectSpread(_objectSpread({},documentSnapShot.docs[0].data()),{},{id:documentSnapShot.docs[0].id,dateAndTimeOfBirth:dateOfBirth}));setProfileLoading(false);}else{setUserProfile(null);setProfileLoading(false);console.log(\"[LOG] user profile does not exist\");}},function(error){setProfileLoading(false);onError&&onError(\"Error fetching user profile\");console.log(\"[LOG] error fetching user profile:\",error);});return unsubscribe;}else{setProfileLoading(false);console.log(\"[LOG] user not logged in\");}},[user,status]);return{user:user,status:status,userProfile:userProfile,setUserProfile:setUserProfile,profileLoading:profileLoading};}","map":{"version":3,"names":["useState","useEffect","firestore","useAuthState","useProfile","onError","user","status","userProfile","setUserProfile","profileLoading","setProfileLoading","console","log","unsubscribe","collection","where","email","onSnapshot","documentSnapShot","docs","length","rawDob","data","dateAndTimeOfBirth","dateOfBirth","toDate","id","error"],"sources":["/Users/sonminhnguyen/Documents/programming/react-native/school/astro_magnet_initial/astro_magnet/src/hooks/useProfile.tsx"],"sourcesContent":["import {useState, useEffect} from \"react\";\nimport firestore from \"@react-native-firebase/firestore\";\nimport useAuthState from \"./useAuthState\";\nimport { User } from \"@app/shared/interfaces/user\";\n\n/**\n * hooks to setup user profile after user has logged in\n * @param {(error: string)=>void | undefined} onError - callback function to handle network error\n * @return {FirebaseAuthTypes.User} user - current logged in user\n * @return status - of authentication: loading-unauthenticated-authenticated\n * @return setupProfile - react setState function to update user profile\n * @return {User|null} userProfile - user profile\n * @return {boolean} profileLoading - loading status of user profile(true-false)\n */\nexport default function useProfile(\n    onError?: (error: string) => void,\n) {\n    const {user, status} = useAuthState();\n    const [userProfile, setUserProfile] = useState<User|null>(null);\n    const [profileLoading, setProfileLoading] = useState<boolean>(true);\n\n    useEffect(() => {\n        if (status===\"loading\") return;\n        if (user) {\n            setProfileLoading(true);\n            console.log(\"[LOG] profile loading\");\n            const unsubscribe = firestore()\n                .collection('users')\n                .where(\"email\", \"==\", user.email)\n                .onSnapshot(documentSnapShot => {\n\n                    //check if user profile exists\n                    if (documentSnapShot && documentSnapShot.docs.length > 0) {\n                        const rawDob = documentSnapShot.docs[0].data().dateAndTimeOfBirth;\n                        const dateOfBirth = rawDob ? rawDob.toDate() : null;\n\n                        //if profile exists, set the profile\n                        setUserProfile({\n                            ...documentSnapShot.docs[0].data(),\n                            id: documentSnapShot.docs[0].id,\n                            dateAndTimeOfBirth: dateOfBirth\n                        } as User);\n                        setProfileLoading(false);\n                    } else {\n\n                        //if profile does not exist, set the profile to null\n                        setUserProfile(null);\n                        setProfileLoading(false);\n                        console.log(\"[LOG] user profile does not exist\")\n                    }\n                }, (error)=> {\n                    setProfileLoading(false);\n                    onError && onError(\"Error fetching user profile\");\n                    console.log(\"[LOG] error fetching user profile:\", error);\n                })\n\n            //unsubscribe on view unmount\n            return unsubscribe;\n        } else {\n            setProfileLoading(false);\n            console.log(\"[LOG] user not logged in\")\n        }\n    }, [user, status]);\n    \n    return {\n        user,\n        status,\n        userProfile,\n        setUserProfile,\n        profileLoading\n    }\n}"],"mappings":"y4BAAA,OAAQA,QAAQ,CAAEC,SAAS,KAAO,OAAO,CACzC,MAAOC,UAAS,KAAM,kCAAkC,CACxD,MAAOC,aAAY,sBAYnB,cAAe,SAASC,WAAU,CAC9BC,OAAiC,CACnC,CACE,kBAAuBF,YAAY,EAAE,CAA9BG,IAAI,eAAJA,IAAI,CAAEC,MAAM,eAANA,MAAM,CACnB,cAAsCP,QAAQ,CAAY,IAAI,CAAC,wCAAxDQ,WAAW,eAAEC,cAAc,eAClC,eAA4CT,QAAQ,CAAU,IAAI,CAAC,yCAA5DU,cAAc,eAAEC,iBAAiB,eAExCV,SAAS,CAAC,UAAM,CACZ,GAAIM,MAAM,GAAG,SAAS,CAAE,OACxB,GAAID,IAAI,CAAE,CACNK,iBAAiB,CAAC,IAAI,CAAC,CACvBC,OAAO,CAACC,GAAG,CAAC,uBAAuB,CAAC,CACpC,GAAMC,YAAW,CAAGZ,SAAS,EAAE,CAC1Ba,UAAU,CAAC,OAAO,CAAC,CACnBC,KAAK,CAAC,OAAO,CAAE,IAAI,CAAEV,IAAI,CAACW,KAAK,CAAC,CAChCC,UAAU,CAAC,SAAAC,gBAAgB,CAAI,CAG5B,GAAIA,gBAAgB,EAAIA,gBAAgB,CAACC,IAAI,CAACC,MAAM,CAAG,CAAC,CAAE,CACtD,GAAMC,OAAM,CAAGH,gBAAgB,CAACC,IAAI,CAAC,CAAC,CAAC,CAACG,IAAI,EAAE,CAACC,kBAAkB,CACjE,GAAMC,YAAW,CAAGH,MAAM,CAAGA,MAAM,CAACI,MAAM,EAAE,CAAG,IAAI,CAGnDjB,cAAc,gCACPU,gBAAgB,CAACC,IAAI,CAAC,CAAC,CAAC,CAACG,IAAI,EAAE,MAClCI,EAAE,CAAER,gBAAgB,CAACC,IAAI,CAAC,CAAC,CAAC,CAACO,EAAE,CAC/BH,kBAAkB,CAAEC,WAAW,GACzB,CACVd,iBAAiB,CAAC,KAAK,CAAC,CAC5B,CAAC,IAAM,CAGHF,cAAc,CAAC,IAAI,CAAC,CACpBE,iBAAiB,CAAC,KAAK,CAAC,CACxBC,OAAO,CAACC,GAAG,CAAC,mCAAmC,CAAC,CACpD,CACJ,CAAC,CAAE,SAACe,KAAK,CAAI,CACTjB,iBAAiB,CAAC,KAAK,CAAC,CACxBN,OAAO,EAAIA,OAAO,CAAC,6BAA6B,CAAC,CACjDO,OAAO,CAACC,GAAG,CAAC,oCAAoC,CAAEe,KAAK,CAAC,CAC5D,CAAC,CAAC,CAGN,MAAOd,YAAW,CACtB,CAAC,IAAM,CACHH,iBAAiB,CAAC,KAAK,CAAC,CACxBC,OAAO,CAACC,GAAG,CAAC,0BAA0B,CAAC,CAC3C,CACJ,CAAC,CAAE,CAACP,IAAI,CAAEC,MAAM,CAAC,CAAC,CAElB,MAAO,CACHD,IAAI,CAAJA,IAAI,CACJC,MAAM,CAANA,MAAM,CACNC,WAAW,CAAXA,WAAW,CACXC,cAAc,CAAdA,cAAc,CACdC,cAAc,CAAdA,cACJ,CAAC,CACL"},"metadata":{},"sourceType":"module"}